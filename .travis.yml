language: generic
sudo: false
env:
  global:
  - TEST_CMD='python -m pytest -vv -s tests'
  - MAIN_CMD='pipenv run'
  - SETUP_XVFB=true
  - PIPENV_IGNORE_VIRTUALENVS=1
matrix:
  fast_finish: true
  include:
  - os: linux
    env: PYTHON_VERSION=3.6
  - os: linux
    env: PYTHON_VERSION=3.7
  - os: osx
    language: generic
    env: PYTHON_VERSION=3.6
  - os: osx
    language: generic
    env: PYTHON_VERSION=3.7
before_install:
- git clone --depth 1 git://github.com/astropy/ci-helpers.git
- source ci-helpers/travis/setup_conda.sh
- source activate test
install:
- pip install pipenv --upgrade-strategy=only-if-needed
- pipenv install --dev .
script:
- "$MAIN_CMD python --version"
- "$MAIN_CMD $TEST_CMD"
- "$MAIN_CMD black . --check"
- "$MAIN_CMD flake8"
notifications:
  on_success: change
  on_failure: always
skip_commits:
  files:
  - docs/**/*
  - "**/*.rst"
  - "*.md"
  - ".gitignore"
  - appveyor.yml
  - LICENSE.txt

deploy:
  provider: pypi
  skip_existing: true
  user: j9ac9k
  password:
    secure: iJ1SuSPOFOyn3dvT3WzH+uLlGdK1y6W4/edVBaa6V0oaLmToZW3I87+9xuR5KIdTlfo64dNd9gSaOEyePn8UzzTc8zOEVxhn+m01DzUaPudVkHQieUtFTTv9svGH7Ir3blBx+tcB+ZcNKyX3947hL7hUSQ0dEDJZlqoqkcwm2chL1OGg6PbAQVZBC9mrUGCOIb5rDX/xDqwlS0TwPBTes6eSVUcG0Nn/zX6BB9JOx6ATiIUVTlBvHiERorJuY8Y5zeUw2ylYzrqfg4x9u6UKD6jprQGcjimjpA8UDXjxLEg9GjKkYDA/XKG5iXrw0v5OqwwzcXHGGGyBkPw/vGZL9xBA4iAKf91uetFeGf8k+VTuXfa0yyvdS3uH3gZQrMNDZzhVMibgxqMi8fESkDoR9NlJh37s7zyt74N49e+yeFof8wBXMuEc7iqyd2JXw5BSa6pPW6N+IQkNAbur5HwN6gEdPTQfKsIN+p2MNEHFJkzyAIBCV3WjejBBgSXVM1OXio4dNmRi9WH+k1Lrrtk0mzJ8gFmt82R1DbuXiAtW8JGsaVXeCg7so1Y0Jl4QSn/W3IwDSP3AeUL8L1dG+ZsfnXQUp5obDqdKjp/dPWBOakNRGJFfh8/+ZDCGyqFMjCNTE3iISD4dlx5CMN7Nu3SWLdECHwkS4+z/Y+298Zb5ch4=
  distributions: sdist bdist_wheel
  on:
    tags: true
